<!DOCTYPE html>
<!--
	This is a simple example of sleeping and then doing something in javascript
	in three different ways:
	- traditional
	- with async promises
	- with async await
-->
<html>
	<head>
		<title>Async</title>
		<script>
			function f1() {
				console.log("f1");
				setTimeout(function() {
					document.getElementById("1").innerHTML="changed";
				}, 3000);
			}
			function sleep(ms) {
				return new Promise(resolve => setTimeout(resolve, ms));
			}
			function resolution(r) {
				setTimeout(r, 1000);
			}
			function more_explicit_sleep() {
				return new Promise(resolution);
			}
			function f2() {
				console.log("f2");
				// const p = sleep(3000);
				const p = more_explicit_sleep();
				p.then(() => {
					document.getElementById("2").innerHTML="changed";
				});
			}
			async function f3() {
				console.log("f3");
				await sleep(3000);
				document.getElementById("3").innerHTML="changed";
			}
			function f4() {
				f3().then((v) => { console.log("foo"+v); });
			}
			async function double_sleep() {
				// the following two lines are exactly the same
				return sleep(3000).then(() => sleep(3000));
				return sleep(3000).then(function() { return sleep(3000); });
			}
			function f5() {
				double_sleep().then(() => { console.log("bar"); });
			}
		</script>
	</head>
	<body>
		<div id="1">0</div><button onclick="f1()">button1</button>
		<div id="2">0</div><button onclick="f2()">button2</button>
		<div id="3">0</div><button onclick="f3()">button3</button>
		<div id="4">0</div><button onclick="f4()">button4</button>
		<div id="5">0</div><button onclick="f5()">button5</button>
	</body>
</html>
